<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tri Shell</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial; background: #111; color: #fff; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; margin: 20px 0; color: #0af; }
    .controls { text-align: center; margin: 20px 0; }
    button { padding: 10px 20px; margin: 0 5px; background: #0af; border: none; color: white; cursor: pointer; }
    button:disabled { background: #555; cursor: not-allowed; }
    .array { display: flex; justify-content: center; margin: 40px 0; height: 100px; }
    .elem { width: 40px; height: 40px; background: #333; margin: 0 2px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .comparing { background: #fa0; }
    .swapping { background: #f00; }
    .sorted { background: #0a0; }
    .steps { background: #222; padding: 15px; margin: 20px 0; border-radius: 5px; min-height: 60px; }
    .stats { display: flex; justify-content: center; gap: 30px; margin: 20px 0; }
</style>
</head>
<body>
<div class="container">
    <h1>Tri Shell</h1>
    
    <div class="controls">
        <button id="startBtn">Démarrer</button>
        <button id="randomBtn">Nouveau</button>
        <button id="speedBtn">Vitesse: ×1</button>
    </div>
    
    <div class="stats">
        <div>Pas: <span id="gap">-</span></div>
        <div>Comparaisons: <span id="comp">0</span></div>
        <div>Décalages: <span id="shift">0</span></div>
    </div>
    
    <div class="array" id="array"></div>
    
    <div class="steps" id="steps">Prêt.</div>
</div>

<script>
let arr = [35, 33, 42, 10, 14, 19, 27, 44, 26, 31];
let running = false;
let speed = 1;

const startBtn = document.getElementById('startBtn');
const randomBtn = document.getElementById('randomBtn');
const speedBtn = document.getElementById('speedBtn');
const steps = document.getElementById('steps');
const gapEl = document.getElementById('gap');
const compEl = document.getElementById('comp');
const shiftEl = document.getElementById('shift');
const arrayEl = document.getElementById('array');

function render() {
    arrayEl.innerHTML = '';
    arr.forEach((val, i) => {
        const div = document.createElement('div');
        div.className = 'elem';
        div.id = 'e' + i;
        div.textContent = val;
        arrayEl.appendChild(div);
    });
}

function update(i, cls) {
    const el = document.getElementById('e' + i);
    if (el) el.className = 'elem ' + cls;
}

function sleep(ms) {
    return new Promise(r => setTimeout(r, ms / speed));
}

async function shellSort() {
    if (running) return;
    running = true;
    startBtn.disabled = true;
    
    const n = arr.length;
    let comp = 0, shift = 0;
    
    // Calcul gaps (Knuth)
    let gap = 1;
    while (gap < n) gap = gap * 3 + 1;
    gap = Math.floor(gap / 3);
    
    while (gap > 0) {
        gapEl.textContent = gap;
        steps.textContent = `Pas = ${gap}`;
        await sleep(500);
        
        for (let i = gap; i < n; i++) {
            const temp = arr[i];
            let j = i;
            
            update(i, 'comparing');
            if (j - gap >= 0) update(j - gap, 'comparing');
            comp++; compEl.textContent = comp;
            await sleep(300);
            
            while (j >= gap && arr[j - gap] > temp) {
                arr[j] = arr[j - gap];
                document.getElementById('e' + j).textContent = arr[j];
                
                update(j - gap, 'swapping');
                update(j, 'swapping');
                shift++; shiftEl.textContent = shift;
                await sleep(300);
                
                update(j - gap, '');
                update(j, '');
                
                j -= gap;
                
                if (j >= gap) {
                    update(j - gap, 'comparing');
                    update(j, 'comparing');
                    comp++; compEl.textContent = comp;
                    await sleep(300);
                }
            }
            
            if (j !== i) {
                arr[j] = temp;
                document.getElementById('e' + j).textContent = temp;
                update(j, 'swapping');
                await sleep(200);
            }
            
            for (let k = 0; k <= i; k++) update(k, 'sorted');
        }
        
        gap = Math.floor(gap / 3);
    }
    
    steps.textContent = `Terminé! ${comp} comparaisons, ${shift} décalages`;
    running = false;
    startBtn.disabled = false;
}

function randomArray() {
    if (running) return;
    arr = Array.from({length: 10}, () => Math.floor(Math.random() * 90) + 10);
    render();
    gapEl.textContent = '-';
    compEl.textContent = '0';
    shiftEl.textContent = '0';
    steps.textContent = 'Nouveau tableau généré';
}

speedBtn.onclick = () => {
    if (speed === 1) { speed = 2; speedBtn.textContent = 'Vitesse: ×2'; }
    else if (speed === 2) { speed = 4; speedBtn.textContent = 'Vitesse: ×4'; }
    else { speed = 1; speedBtn.textContent = 'Vitesse: ×1'; }
};

startBtn.onclick = shellSort;
randomBtn.onclick = randomArray;

render();
</script>
</body>
</html>

